<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickBite - Food Delivery Service</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 
      ============================================================
      CUSTOM CSS STYLES
      ============================================================
    -->
    <style>
        /* --- Base & Layout --- */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif; /* Using a common, clean font */
        }
        .gradient-bg {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        /* --- Login/Auth Page --- */
        #loginPage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            z-index: 100;
            transition: opacity 0.3s ease;
        }
        #mainContent {
            display: none;
        }

        /* --- Restaurant & Menu --- */
        .restaurant-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .restaurant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .offer-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff6b6b;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .veg-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: green;
            display: inline-block;
            margin-right: 5px;
        }
        .nonveg-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e53e3e;
            display: inline-block;
            margin-right: 5px;
        }
        .menu-item-card {
            transition: all 0.3s ease;
        }
        .menu-item-card:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* --- Cart & Notifications --- */
        .cart-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #38a169;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 50;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        /* --- Chatbot --- */
        .chat-bubble {
            max-width: 70%;
            border-radius: 20px;
            padding: 12px 16px;
            margin: 8px;
        }
        .user-bubble {
            background: #ee5a24;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        .bot-bubble {
            background: #f8f9fa;
            color: #333;
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        .chat-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* --- Animations & Utilities --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .error-border {
            border-color: #ef4444 !important;
        }
        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        .rupee-symbol:before {
            content: "₹";
        }
        .discount-tag {
            background: #38a169;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 8px;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ee5a24;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 
      ============================================================
      LOGIN & SIGN UP PAGE
      ============================================================
    -->
    <div id="loginPage" class="gradient-bg">
        
        <!-- Login Form Box -->
        <div id="loginFormBox" class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="flex justify-center items-center mb-6">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/58dca9c0-be32-45ed-96df-58ba9324d0dd.png" 
                         alt="QuickBite logo" class="w-16 h-16 rounded-full">
                </div>
                <h1 class="text-3xl font-bold text-gray-800">QuickBite</h1>
                <p id="loginMessage" class="text-gray-600 mt-2">Sign in to access your account</p>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                           placeholder="Enter your username">
                    <p id="usernameError" class="error-message hidden"></p>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                           placeholder="Enter your password">
                    <p id="passwordError" class="error-message hidden"></p>
                </div>
                <button type="submit" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold text-lg">
                    Sign In
                </button>
            </form>
            <div class="mt-4 text-center">
                <p class="text-gray-600 text-sm">Hint: Without Sign In Your Username and password are "admin"</p>
            </div>
            <div class="mt-6 text-center">
                <p class="text-gray-600">Don't have an account? 
                    <button id="showSignUpBtn" type="button" class="text-orange-500 hover:underline font-semibold">Sign Up</button>
                </p>
            </div>
        </div>

        <!-- Sign Up Form Box (Initially hidden) -->
        <div id="signUpFormBox" class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4 hidden">
            <div class="text-center mb-8">
                <div class="flex justify-center items-center mb-6">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/58dca9c0-be32-45ed-96df-58ba9324d0dd.png" 
                         alt="QuickBite logo" class="w-16 h-16 rounded-full">
                </div>
                <h1 class="text-3xl font-bold text-gray-800">Create Account</h1>
                <p class="text-gray-600 mt-2">Get started with QuickBite</p>
            </div>
            <form id="signUpForm">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Username</label>
                    <input type="text" id="signUpUsername" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                           placeholder="Choose a username">
                    <p id="signUpUsernameError" class="error-message hidden"></p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Email</label>
                    <input type="email" id="signUpEmail" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                           placeholder="Enter your email">
                    <p id="signUpEmailError" class="error-message hidden"></p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Password</label>
                    <input type="password" id="signUpPassword" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                           placeholder="Create a password (min. 6 chars)">
                    <p id="signUpPasswordError" class="error-message hidden"></p>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">Confirm Password</label>
                    <input type="password" id="confirmPassword" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                           placeholder="Confirm your password">
                    <p id="confirmPasswordError" class="error-message hidden"></p>
                </div>
                <button type="submit" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold text-lg">
                    Sign Up
                </button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-gray-600">Already have an account? 
                    <button id="showLoginBtn" type="button" class="text-orange-500 hover:underline font-semibold">Sign In</button>
                </p>
            </div>
        </div>
    </div>

    <!-- 
      ============================================================
      MAIN APPLICATION CONTENT
      ============================================================
    -->
    <div id="mainContent">
        <!-- 
          ----------------------------------------------------------
          NAVIGATION BAR
          ----------------------------------------------------------
        -->
        <nav class="gradient-bg text-white py-4 px-6 shadow-lg fixed top-0 w-full z-40">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/58dca9c0-be32-45ed-96df-58ba9324d0dd.png" alt="QuickBite logo featuring a vibrant orange delivery scooter with food container" class="w-10 h-10 rounded-full">
                    <span class="text-2xl font-bold">QuickBite</span>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="#home" class="hover:text-gray-200">Home</a>
                    <a href="#restaurants" class="hover:text-gray-200">Restaurants</a>
                    <a href="#orders" class="hover:text-gray-200">Orders</a>
                    <a href="#contact" class="hover:text-gray-200">Contact</a>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button class="text-white" id="cartBtn">
                            <i class="fas fa-shopping-cart text-xl"></i>
                            <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hidden">0</span>
                        </button>
                    </div>
                    <button class="text-white" id="logoutBtn">
                        <i class="fas fa-sign-out-alt text-xl"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- 
          ----------------------------------------------------------
          CART SIDEBAR
          ----------------------------------------------------------
        -->
        <div id="cartSidebar" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300">
            <div class="p-6 h-full flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Your Cart</h2>
                    <button id="closeCart" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="cartItems" class="flex-1 overflow-y-auto mb-4">
                    <!-- Cart items will be added here -->
                </div>
                <div class="border-t pt-4">
                    <div class="flex justify-between mb-2">
                        <span>Subtotal:</span>
                        <span id="cartSubtotal">₹0.00</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span>Delivery Fee:</span>
                        <span id="deliveryFee">₹40.00</span>
                    </div>
                    <div class="flex justify-between mb-4 font-bold text-lg">
                        <span>Total:</span>
                        <span id="cartTotal">₹40.00</span>
                    </div>
                    <button id="checkoutBtn" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold">
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
        <div id="cartOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

        <!-- Cart Notification Popup -->
        <div id="cartNotification" class="cart-notification">
            <i class="fas fa-check-circle mr-2"></i>
            <span>Item added to cart!</span>
        </div>

        <!-- Main Content Area -->
        <main class="container mx-auto px-6 py-8 pt-24">
            <!-- 
              ----------------------------------------------------------
              HOME SECTION
              ----------------------------------------------------------
            -->
            <section id="home" class="mb-12 fade-in">
                <!-- Hero Banner -->
                <div class="relative">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/4da259a3-7686-4d26-bad4-59025bdfdb47.png" alt="Delicious food spread featuring various cuisines from multiple restaurants with vibrant colors" class="w-full h-64 object-cover rounded-2xl">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center rounded-2xl">
                        <div class="text-center text-white p-4">
                            <h1 class="text-4xl md:text-5xl font-bold mb-4">Food Delivered to Your Door</h1>
                            <p class="text-xl mb-6">Order from your favorite restaurants in minutes</p>
                            <div class="relative max-w-2xl mx-auto">
                                <input type="text" id="searchInput" placeholder="Search for restaurants or food..." 
                                       class="w-full px-6 py-4 rounded-full text-gray-800 focus:outline-none">
                                <button id="searchBtn" class="absolute right-2 top-2 gradient-bg text-white px-6 py-2 rounded-full">
                                    Search
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Why Choose Us -->
                <div class="mt-8 text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Why Choose QuickBite?</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">Discover a world of flavors with QuickBite. Enjoy fast delivery, a wide range of cuisines, and seamless ordering from top restaurants. Your next meal is just a click away!</p>
                </div>
                
                <!-- Special Offers Section -->
                <div class="mt-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Special Offers</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-r from-orange-100 to-red-100 rounded-2xl p-6 flex items-center">
                            <div class="bg-white p-3 rounded-full mr-4">
                                <i class="fas fa-percentage text-orange-500 text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold">50% OFF</h3>
                                <p class="text-sm text-gray-600">On your first order</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-green-100 to-teal-100 rounded-2xl p-6 flex items-center">
                            <div class="bg-white p-3 rounded-full mr-4">
                                <i class="fas fa-truck text-green-500 text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold">Free Delivery</h3>
                                <p class="text-sm text-gray-600">On orders above ₹299</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-6 flex items-center">
                            <div class="bg-white p-3 rounded-full mr-4">
                                <i class="fas fa-gift text-purple-500 text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold">Free Dessert</h3>
                                <p class="text-sm text-gray-600">With orders above ₹499</Lp>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 
              ----------------------------------------------------------
              RESTAURANTS SECTION
              ----------------------------------------------------------
            -->
            <section id="restaurants" class="mb-12 fade-in">
                <h2 class="text-3xl font-bold text-gray-800 mb-8">Popular Restaurants</h2>
                <!-- Filters -->
                <div class="mb-6 flex flex-wrap gap-2">
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn active" data-filter="all">All</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn" data-filter="italian">Italian</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn" data-filter="chinese">Chinese</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn" data-filter="indian">Indian</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn" data-filter="american">American</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn" data-filter="mexican">Mexican</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn" data-filter="thai">Thai</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm filter-btn" data-filter="desserts">Desserts</button>
                </div>
                <!-- Restaurant List -->
                <div id="restaurantList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Restaurants will be loaded here -->
                </div>
                <div class="text-center mt-8">
                    <button id="loadMoreBtn" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold">
                        Load More Restaurants
                    </button>
                </div>
            </section>

            <!-- 
              ----------------------------------------------------------
              RESTAURANT MENU MODAL
              ----------------------------------------------------------
            -->
            <div id="menuModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
                <div class="bg-white rounded-2xl w-full max-w-4xl max-h-screen overflow-hidden flex flex-col">
                    <div class="relative">
                        <img id="modalRestaurantImage" src="" alt="" class="w-full h-48 object-cover">
                        <button id="closeModal" class="absolute top-4 right-4 bg-white rounded-full p-2 shadow-md">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6 overflow-y-auto flex-1">
                        <h2 id="modalRestaurantName" class="text-2xl font-bold mb-4"></h2>
                        <div id="modalMenuItems" class="space-y-4">
                            <!-- Menu items will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 
              ----------------------------------------------------------
              ORDERS SECTION
              ----------------------------------------------------------
            -->
            <section id="orders" class="mb-12 fade-in">
                <h2 class="text-3xl font-bold text-gray-800 mb-8">Your Orders</h2>
                <div id="orderList" class="bg-white rounded-2xl shadow-md p-6">
                    <div id="orderHistory" class="space-y-4">
                        <p class="text-gray-600 text-center py-8">No orders yet. Your orders will appear here!</p>
                    </div>
                    <div class="text-center mt-6">
                        <button id="addOrderBtn" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold">Add Mock Order</button>
                    </div>
                </div>
            </section>

            <!-- 
              ----------------------------------------------------------
              CONTACT SECTION
              ----------------------------------------------------------
            -->
            <section id="contact" class="mb-12 fade-in">
                <h2 class="text-3xl font-bold text-gray-800 mb-8">Contact Us</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Contact Form -->
                    <div class="bg-white rounded-2xl shadow-md p-6">
                        <h3 class="text-xl font-bold mb-4">Get in Touch</h3>
                        <form id="contactForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Name</label>
                                <input type="text" id="contactName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500">
                                <p id="contactNameError" class="error-message hidden"></p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Email</label>
                                <input type="email" id="contactEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500">
                                <p id="contactEmailError" class="error-message hidden"></p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Message</label>
                                <textarea id="contactMessage" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500" rows="4"></textarea>
                                <p id="contactMessageError" class="error-message hidden"></p>
                            </div>
                            <button type="submit" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold">Send Message</button>
                        </form>
                    </div>
                    <!-- Support Info & Message History -->
                    <div class="bg-white rounded-2xl shadow-md p-6">
                        <h3 class="text-xl font-bold mb-4">Support Information</h3>
                        <p class="text-gray-600 mb-4">We're here to help with your food delivery needs!</p>
                        <ul class="space-y-3 text-gray-600">
                            <li><i class="fas fa-envelope mr-2"></i> support@quickbite.com</li>
                            <li><i class="fas fa-phone mr-2"></i> +91 (800) 123-4567</li>
                            <li><i class="fas fa-map-marker-alt mr-2"></i> 123 Food St, NewTown, Kolkata,India</li>
                        </ul>
                        <h3 class="text-xl font-bold mt-6 mb-4">Message History</h3>
                        <div id="messageHistory" class="space-y-3">
                            <p class="text-gray-600 text-center py-8">No messages yet. Your messages will appear here!</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 
              ----------------------------------------------------------
              DELIVERY TIP SECTION
              ----------------------------------------------------------
            -->
            <section class="bg-gradient-to-r from-orange-50 to-red-50 rounded-2xl p-8 mb-12 fade-in">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Appreciate Your Delivery Hero</h2>
                    <p class="text-gray-600">Show some love to the people who bring food to your door</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Tip Form -->
                    <div class="bg-white p-6 rounded-2xl shadow-md">
                        <h3 class="text-xl font-bold mb-4">Rate and Tip Your Delivery Partner</h3>
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Delivery Partner Name</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg" 
                                   placeholder="Enter delivery partner name" id="deliveryPartnerName">
                            <p id="partnerNameError" class="error-message hidden"></p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Rate your experience</label>
                            <div class="flex space-x-1 text-2xl">
                                <span class="text-gray-300 cursor-pointer" data-rating="1">★</span>
                                <span class="text-gray-300 cursor-pointer" data-rating="2">★</span>
                                <span class="text-gray-300 cursor-pointer" data-rating="3">★</span>
                                <span class="text-gray-300 cursor-pointer" data-rating="4">★</span>
                                <span class="text-gray-300 cursor-pointer" data-rating="5">★</span>
                            </div>
                            <p id="ratingError" class="error-message hidden"></p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Tip Amount</label>
                            <div class="grid grid-cols-3 gap-2 mb-2">
                                <button class="bg-gray-100 py-2 rounded-lg tip-btn" data-amount="50">₹50</button>
                                <button class="bg-gray-100 py-2 rounded-lg tip-btn" data-amount="100">₹100</button>
                                <button class="bg-gray-100 py-2 rounded-lg tip-btn" data-amount="200">₹200</button>
                            </div>
                            <input type="number" placeholder="Custom amount" min="0" step="1"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg" id="customTip">
                            <p id="tipError" class="error-message hidden"></p>
                        </div>
                        <button class="w-full gradient-bg text-white py-3 rounded-lg font-semibold" id="submitTip">
                            Send Tip & Rating
                        </button>
                    </div>
                    <!-- Tip History -->
                    <div class="bg-white p-6 rounded-2xl shadow-md">
                        <h3 class="text-xl font-bold mb-4">Recent Tips Given</h3>
                        <div id="tipHistory" class="space-y-3">
                            <p class="text-gray-600 text-center py-8">No tips given yet. Your appreciation will appear here!</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 
              ----------------------------------------------------------
              CHATBOT SECTION
              ----------------------------------------------------------
            -->
            <section class="bg-white rounded-2xl shadow-md p-6 mb-12 fade-in">
                <div class="flex items-center mb-6">
                    <div class="w-12 h-12 gradient-bg rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-robot text-white text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold">QuickBite Assistant</h2>
                        <p class="text-gray-600">Get help with orders, tracking, and more</p>
                    </div>
                </div>
                <div class="chat-container bg-gray-50 rounded-2xl p-4 mb-4" id="chatMessages">
                    <div class="bot-bubble chat-bubble">
                        Hi there! I'm here to help with your food delivery needs. How can I assist you today?
                    </div>
                </div>
                <div class="flex space-x-2">
                    <input type="text" placeholder="Type your message..." 
                           class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" id="chatInput">
                    <button class="gradient-bg text-white px-6 py-3 rounded-lg" id="sendMessage">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="mt-4 flex flex-wrap gap-2">
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm quick-reply">Order Status</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm quick-reply">Menu Items</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm quick-reply">Delivery Time</button>
                    <button class="bg-gray-100 px-4 py-2 rounded-lg text-sm quick-reply">Payment Issues</button>
                </div>
            </section>
        </main>

        <!-- 
          ----------------------------------------------------------
          FOOTER
          ----------------------------------------------------------
        -->
        <footer class="bg-gray-800 text-white py-12">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 class="text-xl font-bold mb-4">QuickBite</h3>
                        <p class="text-gray-400">Delivering happiness to your doorstep since 2024</p>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Quick Links</h4>
                        <ul class="space-y-2">
                            <li><a href="#home" class="text-gray-400 hover:text-white">Home</a></li>
                            <li><a href="#restaurants" class="text-gray-400 hover:text-white">Restaurants</a></li>
                            <li><a href="#orders" class="text-gray-400 hover:text-white">Orders</a></li>
                            <li><a href="#contact" class="text-gray-400 hover:text-white">Contact</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Legal</h4>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-white">Terms & Conditions</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white">Cookie Policy</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Follow Us</h4>
                        <div class="flex space-x-4">
                            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook text-xl"></i></a>
                            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter text-xl"></i></a>
                            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram text-xl"></i></a>
                        </div>
                    </div>
                </div>
                <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                    <p>© 2024 QuickBite. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- 
      ============================================================
      JAVASCRIPT
      ============================================================
    -->
    <script>
        // ==========================================================
// --- STEP 7: CONNECTING TO THE BACKEND ---
// ==========================================================

// Define the single source of truth for your backend API
const API_URL = 'https://quickbite-backend-2ll2.onrender.com/api';

// --- Global Notification Function (Unchanged) ---
function showCartNotification(message) {
    const notification = document.getElementById('cartNotification');
    notification.querySelector('span').textContent = message;
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// --- Login, Sign Up & Auth ---
(function() {
    const loginPage = document.getElementById('loginPage');
    const mainContent = document.getElementById('mainContent');
    
    // Forms and Boxes
    const loginFormBox = document.getElementById('loginFormBox');
    const signUpFormBox = document.getElementById('signUpFormBox');
    const loginForm = document.getElementById('loginForm');
    const signUpForm = document.getElementById('signUpForm');

    // Toggle Buttons
    const showSignUpBtn = document.getElementById('showSignUpBtn');
    const showLoginBtn = document.getElementById('showLoginBtn');

    // Login Inputs
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const usernameError = document.getElementById('usernameError');
    const passwordError = document.getElementById('passwordError');
    const loginMessage = document.getElementById('loginMessage');

    // Other Elements
    const logoutBtn = document.getElementById('logoutBtn');

    // Toggle Listeners (Unchanged)
    showSignUpBtn.addEventListener('click', () => {
        loginFormBox.classList.add('hidden');
        signUpFormBox.classList.remove('hidden');
        loginForm.reset();
        clearLoginErrors();
    });

    showLoginBtn.addEventListener('click', () => {
        signUpFormBox.classList.add('hidden');
        loginFormBox.classList.remove('hidden');
        signUpForm.reset();
        clearSignUpErrors();
    });

    // === CHANGED IN STEP 7 ===
    // Check if user is already logged in (by checking for the token)
    window.checkLoginStatus = function() {
        const token = localStorage.getItem('token');
        if (token) {
            loginPage.style.display = 'none';
            mainContent.style.display = 'block';
            
            // Load all data now that we're logged in
            window.loadRestaurants();
            window.loadOrders();
            window.loadMessages();
        } else {
            loginPage.style.display = 'flex';
            mainContent.style.display = 'none';
        }
    }

    function clearLoginErrors() {
        usernameError.classList.add('hidden');
        passwordError.classList.add('hidden');
        usernameError.textContent = '';
        passwordError.textContent = '';
        loginMessage.textContent = 'Sign in to access your account';
        loginMessage.classList.remove('text-green-600', 'text-red-600');
    }

    function clearSignUpErrors() {
        document.getElementById('signUpUsernameError').classList.add('hidden');
        document.getElementById('signUpEmailError').classList.add('hidden');
        document.getElementById('signUpPasswordError').classList.add('hidden');
        document.getElementById('confirmPasswordError').classList.add('hidden');
    }

    // === CHANGED IN STEP 7 ===
    // Handle login form submission (now async and calls API)
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        clearLoginErrors();
        
        try {
            const response = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            
            const data = await response.json();

            if (response.ok) {
                // --- SUCCESS ---
                // Store the token from the server
                localStorage.setItem('token', data.token);
                
                loginPage.style.opacity = '0';
                setTimeout(() => {
                    window.checkLoginStatus(); // Re-check login status
                }, 300);
            } else {
                // --- FAILED LOGIN ---
                passwordError.textContent = data.message || 'Invalid username or password';
                passwordError.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Login error:', error);
            passwordError.textContent = 'Could not connect to server. Is it running?';
            passwordError.classList.remove('hidden');
        }
    });

    // === CHANGED IN STEP 7 ===
    // Handle Sign Up form submission (now async and calls API)
    signUpForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Get sign-up inputs and errors
        const signUpUsernameInput = document.getElementById('signUpUsername');
        const signUpEmailInput = document.getElementById('signUpEmail');
        const signUpPasswordInput = document.getElementById('signUpPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');

        const signUpUsernameError = document.getElementById('signUpUsernameError');
        const signUpEmailError = document.getElementById('signUpEmailError');
        const signUpPasswordError = document.getElementById('signUpPasswordError');
        const confirmPasswordError = document.getElementById('confirmPasswordError');

        clearSignUpErrors();
        
        // Get values
        const username = signUpUsernameInput.value.trim();
        const email = signUpEmailInput.value.trim();
        const password = signUpPasswordInput.value.trim();
        const confirmPassword = confirmPasswordInput.value.trim();
        
        // --- Frontend validation ---
        let hasError = false;
        if (!username) { /* ... (all your existing validation) ... */ hasError = true; }
        if (!email || !email.includes('@')) { /* ... */ hasError = true; }
        if (password.length < 6) { /* ... */ hasError = true; }
        if (password !== confirmPassword) { /* ... */ hasError = true; }
        
        if (hasError) return;

        // --- Send to API ---
        try {
            const response = await fetch(`${API_URL}/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email, password })
            });
            
            const data = await response.json();

            if (response.ok) { // 201 Created
                loginMessage.textContent = 'Sign up successful! Please sign in.';
                loginMessage.classList.add('text-green-600');
                showLoginBtn.click(); // Switch to login form
                signUpForm.reset();
            } else {
                // Show server-side error (e.g., "Username already exists")
                signUpUsernameError.textContent = data.message;
                signUpUsernameError.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Signup error:', error);
            signUpUsernameError.textContent = 'Could not connect to server.';
            signUpUsernameError.classList.remove('hidden');
        }
    });

    // === CHANGED IN STEP 7 ===
    // Handle logout (now removes token)
    logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('token'); // Remove the token
        
        mainContent.style.display = 'none';
        loginPage.style.display = 'flex';

        loginFormBox.classList.remove('hidden');
        signUpFormBox.classList.add('hidden');
        
        setTimeout(() => {
            loginPage.style.opacity = '1';
        }, 10);

        loginForm.reset();
        signUpForm.reset();
        clearLoginErrors();
        clearSignUpErrors();
    });
})();

// --- App Initialization (REMOVED) ---
// We removed the localStorage initialization for orders, messages, etc.
// That data will now come from our database.

// === CHANGED IN STEP 7 ===
// --- Restaurant & Menu Modal ---
// The old mock `restaurants` array is GONE.
(function() {
    // We keep a local cache of restaurant data to avoid re-fetching
    let allRestaurants = [];
    
    // Make loadRestaurants globally accessible
    window.loadRestaurants = async function() {
        const restaurantList = document.getElementById('restaurantList');
        restaurantList.innerHTML = '<p class="text-gray-600">Loading restaurants...</p>';
        
        try {
            const response = await fetch(`${API_URL}/restaurants`);
            if (!response.ok) throw new Error('Failed to fetch');
            
            allRestaurants = await response.json(); // Store in our cache
            
            restaurantList.innerHTML = ''; // Clear "Loading..."
            
            if (allRestaurants.length === 0) {
                 restaurantList.innerHTML = '<p class="text-gray-600">No restaurants found. (Did you run the import_data.py script?)</p>';
                 return;
            }

            // Display only 8, but we have all of them in `allRestaurants`
            allRestaurants.slice(0, 8).forEach(restaurant => {
                const restaurantCard = document.createElement('div');
                restaurantCard.className = 'restaurant-card bg-white rounded-2xl shadow-md overflow-hidden';
                restaurantCard.setAttribute('data-cuisine', restaurant.cuisine);
                restaurantCard.setAttribute('data-name', restaurant.name.toLowerCase());
                
                // Use restaurant._id from the database
                restaurantCard.innerHTML = `
                    <div class="relative">
                        <img src="${restaurant.image}" alt="${restaurant.name}" class="w-full h-48 object-cover" onerror="this.src='https://placehold.co/600x400/ff6b6b/white?text=${restaurant.name}';">
                        ${restaurant.offer ? `<div class="offer-badge">${restaurant.offer}</div>` : ''}
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">${restaurant.name}</h3>
                        <div class="flex items-center mb-2">
                            <span class="text-yellow-400">${'★'.repeat(Math.floor(restaurant.rating))}${'☆'.repeat(5-Math.floor(restaurant.rating))}</span>
                            <span class="text-gray-600 ml-2">${restaurant.rating} (${restaurant.reviews})</span>
                        </div>
                        <p class="text-gray-600 mb-3">${restaurant.cuisine.charAt(0).toUpperCase() + restaurant.cuisine.slice(1)} • ${restaurant.priceRange} • ${restaurant.deliveryTime}</p>
                        <button class="w-full gradient-bg text-white py-2 rounded-lg view-menu" data-id="${restaurant._id}">View Menu</button>
                    </div>
                `;
                
                restaurantList.appendChild(restaurantCard);
            });
            
            // Add event listeners to menu buttons
            document.querySelectorAll('.view-menu').forEach(button => {
                button.addEventListener('click', (e) => {
                    const restaurantId = e.target.getAttribute('data-id'); // This is the MongoDB _id
                    openMenuModal(restaurantId);
                });
            });

        } catch (error) {
            console.error('Error loading restaurants:', error);
            restaurantList.innerHTML = '<p class="text-red-500">Error loading restaurants. Please try again.</p>';
        }
    }

    // === CHANGED IN STEP 7 ===
    // Now fetches the single restaurant's data
    async function openMenuModal(restaurantId) {
        // Find in cache first, if not, fetch
        let restaurant = allRestaurants.find(r => r._id === restaurantId);
        
        if (!restaurant) {
            // This is a fallback, but data should be in the cache
            try {
                const response = await fetch(`${API_URL}/restaurants/${restaurantId}`);
                if (!response.ok) throw new Error('Restaurant not found');
                restaurant = await response.json();
            } catch (error) {
                console.error('Error fetching single restaurant:', error);
                showCartNotification("Could not load restaurant menu.");
                return;
            }
        }
        
        const modal = document.getElementById('menuModal');
        const modalImage = document.getElementById('modalRestaurantImage');
        const modalName = document.getElementById('modalRestaurantName');
        const modalMenu = document.getElementById('modalMenuItems');
        
        modalImage.src = restaurant.image;
        modalImage.alt = restaurant.name;
        modalImage.onerror = () => { modalImage.src = `https://placehold.co/600x400/ff6b6b/white?text=${restaurant.name}`; };
        modalName.textContent = restaurant.name;
        
        // Populate menu items
        modalMenu.innerHTML = '';
        restaurant.menu.forEach(item => {
            const menuItem = document.createElement('div');
            menuItem.className = 'menu-item-card bg-white p-4 rounded-lg shadow-sm border border-gray-100';
            menuItem.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="flex items-center mb-1">
                            <span class="${item.veg ? 'veg-indicator' : 'nonveg-indicator'}"></span>
                            <h3 class="font-semibold">${item.name}</h3>
                            ${item.popular ? '<span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded ml-2">Popular</span>' : ''}
                        </div>
                        <p class="text-gray-600 text-sm mb-2">${item.description}</p>
                        <p class="font-bold">₹${item.price}</p>
                    </div>
                    <button class="bg-white border border-orange-500 text-orange-500 px-3 py-1 rounded-lg add-to-cart ml-4" data-id="${item.id}" data-restaurant-id="${restaurant._id}">Add</button>
                </div>
            `;
            modalMenu.appendChild(menuItem);
        });
        
        // Show modal
        modal.classList.remove('hidden');
        
        // Add event listeners to add to cart buttons
        modalMenu.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', (e) => {
                const itemId = parseInt(e.target.getAttribute('data-id'));
                const restaurantId = e.target.getAttribute('data-restaurant-id');
                // Find the full item object to pass to the cart
                const restaurant = allRestaurants.find(r => r._id === restaurantId);
                const item = restaurant.menu.find(i => i.id === itemId);
                window.addToCart(item, restaurant); // Call global cart function
            });
        });
    }

    // Close menu modal (Unchanged)
    document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('menuModal').classList.add('hidden');
    });
})();

// --- Cart & Checkout ---
(function() {
    // ... (All cart elements are the same) ...
    const cartBtn = document.getElementById('cartBtn');
    const cartSidebar = document.getElementById('cartSidebar');
    const closeCart = document.getElementById('closeCart');
    const cartOverlay = document.getElementById('cartOverlay');
    const cartItems = document.getElementById('cartItems');
    const cartSubtotal = document.getElementById('cartSubtotal');
    const cartTotal = document.getElementById('cartTotal');
    const checkoutBtn = document.getElementById('checkoutBtn');

    // === CHANGED IN STEP 7 ===
    // Cart logic now uses `localStorage` as a *temporary* holder
    // The database is the source of truth for orders
    
    // `item` and `restaurant` are now full objects
    window.addToCart = function(item, restaurant) {
        if (!item) return;
        
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        const existingItemIndex = cart.findIndex(i => i.id === item.id && i.restaurantId === restaurant._id);
        
        if (existingItemIndex !== -1) {
            cart[existingItemIndex].quantity += 1;
        } else {
            cart.push({
                id: item.id,
                name: item.name,
                price: item.price,
                restaurantId: restaurant._id,
                restaurantName: restaurant.name,
                quantity: 1
            });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        showCartNotification(`${item.name} added to cart!`);
    }

    window.updateCartCount = function() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartCount = document.getElementById('cartCount');
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        
        if (totalItems > 0) {
            cartCount.textContent = totalItems;
            cartCount.classList.remove('hidden');
        } else {
            cartCount.classList.add('hidden');
        }
    }

    // `renderCartItems` and `updateCartItemQuantity` are mostly unchanged
    // as they just manage the `localStorage` cart.
    function renderCartItems() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cartItems.innerHTML = '';
        
        if (cart.length === 0) {
            cartItems.innerHTML = '<p class="text-gray-500 text-center py-8">Your cart is empty</p>';
            cartSubtotal.textContent = '₹0.00';
            cartTotal.textContent = '₹40.00'; // Base delivery fee
            return;
        }
        
        let subtotal = 0;
        
        cart.forEach(item => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;
            
            const cartItem = document.createElement('div');
            cartItem.className = 'flex justify-between items-center py-4 border-b';
            cartItem.innerHTML = `
                <div class="flex-1">
                    <h3 class="font-semibold">${item.name}</h3>
                    <p class="text-gray-600">${item.restaurantName}</p>
                    <p class="text-orange-500 font-semibold">₹${item.price}</p>
                </div>
                <div class="flex items-center">
                    <button class="decrease-quantity w-8 h-8 rounded-full border border-gray-300" data-id="${item.id}" data-restaurant="${item.restaurantId}">-</button>
                    <span class="mx-2">${item.quantity}</span>
                    <button class="increase-quantity w-8 h-8 rounded-full border border-gray-300" data-id="${item.id}" data-restaurant="${item.restaurantId}">+</button>
                </div>
            `;
            cartItems.appendChild(cartItem);
        });
        
        // Add event listeners to quantity buttons
        cartItems.querySelectorAll('.increase-quantity').forEach(button => {
            button.addEventListener('click', (e) => {
                const itemId = parseInt(e.target.getAttribute('data-id'));
                const restaurantId = e.target.getAttribute('data-restaurant');
                updateCartItemQuantity(itemId, restaurantId, 1);
            });
        });
        
        cartItems.querySelectorAll('.decrease-quantity').forEach(button => {
            button.addEventListener('click', (e) => {
                const itemId = parseInt(e.target.getAttribute('data-id'));
                const restaurantId = parseInt(e.target.getAttribute('data-restaurant'));
                updateCartItemQuantity(itemId, restaurantId, -1);
            });
        });
        
        // Update totals
        const deliveryFee = 40;
        cartSubtotal.textContent = `₹${subtotal.toFixed(2)}`;
        cartTotal.textContent = `₹${(subtotal + deliveryFee).toFixed(2)}`;
    }

    function updateCartItemQuantity(itemId, restaurantId, change) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const itemIndex = cart.findIndex(i => i.id === itemId && i.restaurantId === restaurantId);
        
        if (itemIndex !== -1) {
            cart[itemIndex].quantity += change;
            if (cart[itemIndex].quantity <= 0) {
                cart.splice(itemIndex, 1);
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }
    }

    function openCart() {
        cartSidebar.classList.remove('translate-x-full');
        cartOverlay.classList.remove('hidden');
        renderCartItems();
    }

    function closeCartSidebar() {
        cartSidebar.classList.add('translate-x-full');
        cartOverlay.classList.add('hidden');
    }

    cartBtn.addEventListener('click', openCart);
    closeCart.addEventListener('click', closeCartSidebar);
    cartOverlay.addEventListener('click', closeCartSidebar);

    // === CHANGED IN STEP 7 ===
    // Checkout now calls the protected API
    checkoutBtn.addEventListener('click', async () => {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart.length === 0) {
            showCartNotification("Your cart is empty!");
            return;
        }

        const token = localStorage.getItem('token');
        if (!token) {
            showCartNotification("Please log in to check out.");
            return;
        }
        
        checkoutBtn.innerHTML = '<div class="loading-spinner"></div> Processing...';
        checkoutBtn.disabled = true;
        
        const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        const deliveryFee = 40;
        const total = subtotal + deliveryFee;

        // Prepare order for API
        const orderData = {
            items: cart.map(item => ({ name: item.name, quantity: item.quantity, price: item.price })),
            total: total
        };

        try {
            const response = await fetch(`${API_URL}/checkout`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` // Send the token!
                },
                body: JSON.stringify(orderData)
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('cart', JSON.stringify([])); // Clear cart
                updateCartCount();
                closeCartSidebar();
                showCartNotification(`Order placed successfully!`);
                window.loadOrders(); // Reload orders from DB
            } else {
                throw new Error(data.message);
            }

        } catch (error) {
            console.error('Checkout error:', error);
            showCartNotification(`Error: ${error.message}`);
        } finally {
            checkoutBtn.innerHTML = 'Proceed to Checkout';
            checkoutBtn.disabled = false;
        }
    });
})();

// --- Search & Filter (Unchanged) ---
// This section still filters the *visible* cards, so its logic is fine.
(function() {
    // ... (all code in this section remains the same) ...
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const loadMoreBtn = document.getElementById('loadMoreBtn');

    function filterRestaurants(searchTerm = '', cuisineFilter = 'all') {
        const restaurantCards = document.querySelectorAll('.restaurant-card');
        restaurantCards.forEach(card => {
            const name = card.getAttribute('data-name');
            const cuisine = card.getAttribute('data-cuisine');
            const matchesSearch = name.includes(searchTerm.toLowerCase());
            const matchesCuisine = cuisineFilter === 'all' || cuisine === cuisineFilter;
            card.classList.toggle('hidden', !(matchesSearch && matchesCuisine));
        });
    }

    searchBtn.addEventListener('click', () => {
        filterRestaurants(searchInput.value);
    });

    searchInput.addEventListener('input', () => {
        filterRestaurants(searchInput.value);
    });

    filterButtons.forEach(button => {
        button.addEventListener('click', () => {
            const filter = button.getAttribute('data-filter');
            filterButtons.forEach(btn => btn.classList.remove('active', 'gradient-bg', 'text-white'));
            button.classList.add('active', 'gradient-bg', 'text-white');
            filterRestaurants(searchInput.value, filter);
        });
    });

    loadMoreBtn.addEventListener('click', () => {
        showCartNotification('More restaurants loaded!');
    });
})();

// === CHANGED IN STEP 7 ===
// --- Order History ---
// Now fetches from the protected API
(function() {
    const orderHistory = document.getElementById('orderHistory');
    const addOrderBtn = document.getElementById('addOrderBtn');

    window.loadOrders = async function() {
        const token = localStorage.getItem('token');
        if (!token) {
            orderHistory.innerHTML = '<p class="text-gray-600 text-center py-8">Please log in to view your orders.</p>';
            return;
        }

        orderHistory.innerHTML = '<p class="text-gray-600 text-center py-8">Loading your orders...</p>';

        try {
            const response = await fetch(`${API_URL}/orders`, {
                headers: {
                    'Authorization': `Bearer ${token}` // Send the token!
                }
            });

            if (!response.ok) {
                if (response.status === 401) {
                    orderHistory.innerHTML = '<p class="text-red-500 text-center py-8">Your session has expired. Please log out and log in again.</p>';
                    return;
                }
                throw new Error('Failed to fetch orders');
            }
            
            const orders = await response.json();
            
            orderHistory.innerHTML = orders.length === 0 
                ? '<p class="text-gray-600 text-center py-8">No orders yet. Your orders will appear here!</p>'
                : '';

            orders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'border-b border-gray-200 pb-4';
                // Use data from the server (note: order.total is already a number)
                orderDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-lg">Order ID: #${order._id.slice(-6)}</h3>
                            <p class="text-gray-600">${order.items[0].name} ${order.items.length > 1 ? `and ${order.items.length - 1} more` : ''}</p>
                            <p class="font-semibold text-gray-800">₹${Number(order.total).toFixed(2)}</p>
                            <p class="text-sm text-gray-500">${order.date}</p>
                        </div>
                        <span class="text-${order.status === 'Delivered' ? 'green' : 'blue'}-600 font-semibold">${order.status}</span>
                    </div>
                `;
                orderHistory.appendChild(orderDiv);
            });
        } catch (e) {
            console.error('Error loading orders:', e);
            orderHistory.innerHTML = '<p class="text-red-600 text-center py-8">Error loading orders. Please try again.</p>';
        }
    }

    // We can now remove the "Add Mock Order" button
    addOrderBtn.style.display = 'none'; // Hide the button
})();

// === CHANGED IN STEP 7 ===
// --- Contact Form ---
// Now sends data to the (not-yet-created) API
// Note: We haven't created these API endpoints in app.py yet,
// but this is how you would. For now, we'll keep using localStorage.
(function() {
    const contactForm = document.getElementById('contactForm');
    const messageHistory = document.getElementById('messageHistory');
    const contactName = document.getElementById('contactName');
    const contactEmail = document.getElementById('contactEmail');
    const contactMessage = document.getElementById('contactMessage');
    const contactNameError = document.getElementById('contactNameError');
    const contactEmailError = document.getElementById('contactEmailError');
    const contactMessageError = document.getElementById('contactMessageError');

    function clearContactErrors() {
        contactName.classList.remove('error-border');
        contactEmail.classList.remove('error-border');
        contactMessage.classList.remove('error-border');
        contactNameError.classList.add('hidden');
        contactEmailError.classList.add('hidden');
        contactMessageError.classList.add('hidden');
    }

    // This still uses localStorage, as we didn't build the API for it.
    // This is a good next step for you to build!
    window.loadMessages = function() {
        try {
            const messages = JSON.parse(localStorage.getItem('messages')) || [];
            messageHistory.innerHTML = messages.length === 0 
                ? '<p class="text-gray-600 text-center py-8">No messages yet. Your messages will appear here!</p>'
                : '';
            messages.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.className = 'bg-orange-50 p-4 rounded-lg';
                msgDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">${msg.name}</span>
                        <span class="text-gray-600 text-sm">${msg.date}</span>
                    </div>
                    <p class="text-gray-600 mt-2">${msg.message}</p>
                `;
                messageHistory.prepend(msgDiv);
            });
        } catch (e) {
            console.error('Error loading messages:', e);
            messageHistory.innerHTML = '<p class="text-red-600 text-center py-8">Error loading messages. Please try again.</p>';
        }
    }

    contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        clearContactErrors();
        const name = contactName.value.trim();
        const email = contactEmail.value.trim();
        const message = contactMessage.value.trim();
        let hasError = false;

        // ... (all your existing validation) ...
        if (!name) { /* ... */ hasError = true; }
        if (!email) { /* ... */ hasError = true; }
        if (!message) { /* ... */ hasError = true; }
        if (hasError) return;

        // TODO: Create a POST /api/contact endpoint and send this data
        // For now, we just save to localStorage
        try {
            const messages = JSON.parse(localStorage.getItem('messages')) || [];
            messages.push({ name, email, message, date: new Date().toLocaleDateString() });
            localStorage.setItem('messages', JSON.stringify(messages));
            contactForm.reset();
            loadMessages();
            showCartNotification("Message sent successfully!");
        } catch (e) {
            console.error('Error saving message:', e);
            showCartNotification('Error saving message. Please try again.');
        }
    });
})();

// --- Chatbot (Unchanged) ---
(function() {
    // ... (all code in this section remains the same) ...
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendMessageBtn = document.getElementById('sendMessage');
    const quickReplies = document.querySelectorAll('.quick-reply');

    const botResponses = {
        'order status': 'To check your order status, please check the "Orders" section above.',
        'menu items': 'You can browse our complete menu by selecting a restaurant from the "Restaurants" section.',
        'delivery time': 'Delivery times vary by restaurant and location. Typical delivery times range from 20-45 minutes.',
        'payment issues': 'For payment issues, please check your payment method details or contact our support team at support@quickbite.com',
        'default': 'I can help with order status, menu items, delivery times, and payment issues. What would you like to know?'
    };

    function addMessage(message, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = isUser ? 'user-bubble chat-bubble' : 'bot-bubble chat-bubble';
        messageDiv.textContent = message;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function handleMessage(message) {
        const lowerMessage = message.toLowerCase();
        let response = botResponses.default;
        for (const [key, value] of Object.entries(botResponses)) {
            if (lowerMessage.includes(key) && key !== 'default') {
                response = value;
                break;
            }
        }
        setTimeout(() => addMessage(response), 1000);
    }

    sendMessageBtn.addEventListener('click', () => {
        const message = chatInput.value.trim();
        if (message) {
            addMessage(message, true);
            chatInput.value = '';
            handleMessage(message);
        }
    });

    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessageBtn.click();
    });

    quickReplies.forEach(button => {
        button.addEventListener('click', () => {
            const message = button.textContent;
            addMessage(message, true);
            handleMessage(message);
        });
    });
})();

// --- Tip & Rating (Unchanged) ---
// This is also a good candidate for a new API endpoint!
(function() {
    // ... (all code in this section remains the same) ...
    const tipButtons = document.querySelectorAll('.tip-btn');
    const customTip = document.getElementById('customTip');
    const submitTip = document.getElementById('submitTip');
    const tipHistory = document.getElementById('tipHistory');
    const ratingStars = document.querySelectorAll('[data-rating]');
    const deliveryPartnerName = document.getElementById('deliveryPartnerName');
    const partnerNameError = document.getElementById('partnerNameError');
    const ratingError = document.getElementById('ratingError');
    const tipError = document.getElementById('tipError');
    
    let selectedRating = 0;
    let selectedTipAmount = 0;

    function clearTipErrors() {
        deliveryPartnerName.classList.remove('error-border');
        partnerNameError.classList.add('hidden');
        ratingError.classList.add('hidden');
        customTip.classList.remove('error-border');
        tipError.classList.add('hidden');
    }

    ratingStars.forEach(star => {
        star.addEventListener('click', () => {
            selectedRating = parseInt(star.getAttribute('data-rating'));
            ratingStars.forEach((s, index) => {
                s.classList.toggle('text-yellow-400', index < selectedRating);
                s.classList.toggle('text-gray-300', index >= selectedRating);
            });
            clearTipErrors();
        });
    });

    tipButtons.forEach(button => {
        button.addEventListener('click', () => {
            tipButtons.forEach(btn => btn.classList.remove('gradient-bg', 'text-white'));
            button.classList.add('gradient-bg', 'text-white');
            selectedTipAmount = parseFloat(button.getAttribute('data-amount'));
            customTip.value = '';
            clearTipErrors();
        });
    });

    customTip.addEventListener('input', () => {
        tipButtons.forEach(btn => btn.classList.remove('gradient-bg', 'text-white'));
        const value = parseFloat(customTip.value);
        selectedTipAmount = (value >= 0 && !isNaN(value)) ? value : 0;
        clearTipErrors();
    });

    submitTip.addEventListener('click', () => {
        clearTipErrors();
        const partnerName = deliveryPartnerName.value.trim();
        let hasError = false;

        if (!partnerName) {
            deliveryPartnerName.classList.add('error-border');
            partnerNameError.textContent = 'Please enter the delivery partner name';
            partnerNameError.classList.remove('hidden');
            hasError = true;
        }
        if (selectedRating === 0) {
            ratingError.textContent = 'Please rate your delivery experience';
            ratingError.classList.remove('hidden');
            hasError = true;
        }
        if (selectedTipAmount === 0) {
            customTip.classList.add('error-border');
            tipError.textContent = 'Please select or enter a tip amount';
            tipError.classList.remove('hidden');
            hasError = true;
        }
        if (hasError) return;

        // TODO: Create a POST /api/tip endpoint
        const tipEntry = document.createElement('div');
        tipEntry.className = 'bg-orange-50 p-4 rounded-lg';
        tipEntry.innerHTML = `
            <div class="flex justify-between items-center">
                <span class="font-semibold">${partnerName}</span>
                <span class="text-green-600 font-bold">₹${selectedTipAmount.toFixed(2)}</span>
            </div>
            <div class="flex text-yellow-400 mt-1">
                ${'★'.repeat(selectedRating)}${'☆'.repeat(5 - selectedRating)}
            </div>
            <div class="text-sm text-gray-600 mt-2">${new Date().toLocaleDateString()}</div>
        `;
        if (tipHistory.querySelector('.text-gray-600')) {
            tipHistory.innerHTML = '';
        }
        tipHistory.prepend(tipEntry);
        deliveryPartnerName.value = '';
        ratingStars.forEach(star => {
            star.classList.add('text-gray-300');
            star.classList.remove('text-yellow-400');
        });
        tipButtons.forEach(btn => btn.classList.remove('gradient-bg', 'text-white'));
        customTip.value = '';
        selectedRating = 0;
        selectedTipAmount = 0;
        showCartNotification(`Thank you for tipping ${partnerName}!`);
    });
})();

// --- Initial Page Load ---
(function() {
    window.checkLoginStatus(); // Check if we have a token and show the correct page
    window.updateCartCount();  // Update cart from localStorage
    
    // The checkLoginStatus() function now handles loading data
    // if the user is already logged in.
})();
        </script>
</body>
</html>
